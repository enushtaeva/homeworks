@using ClassLibrary1
@model List<StatisticOnTask>
@{
    ViewBag.Title = "Статистика";
}
<br />
<br />
<h1 class="starter-template" style="text-align:center">Статистика из базы данных</h1>
<br />
<br />
<table class="table" id="mt">
    <tr>
        <th>Дата игры</th>
        <th>Время игры</th>
        <th>Результат</th>
        <th>Фигура пользователя</th>
        <th>Количество ходов</th>
    </tr>
    @foreach (StatisticOnTask stat in Model)
    {
        <tr>
            <td>@stat.DateOfStart.ToString("d")</td>
            <td>@string.Format("{0:hh\\:mm\\:ss}", stat.TimeToPlay)</td>
            <td>@((stat.Result==0)?"WinOfUser":(stat.Result==1)?"WinOfComputer":"Draw")</td>
            <td>@((stat.X==1)?"X":"O")</td>
            <td>@stat.CountOfStep</td>
        </tr>
    }
</table>
<br />
<p style="margin-left:200px">Процент выигрышей пользователя:</p>
<p style="display:block; margin-left:400px; font-size:24px;color:#0094ff;margin-bottom:50px;" id="proc">@ViewBag.Message</p>
<p  style="margin-left:200px">@ViewBag.ErrorText</p>
@section scripts {

    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script type="text/javascript">
    var chat = $.connection.statisticHub;
        // Create a function that the hub can call to broadcast messages.
    chat.client.updateprocents = function (data) {
        $("#proc").text(data);
    }
    chat.client.updateStatisticTask = function (data) {
        $("#mt tbody").find("tr:gt(0)").remove();
       var data1 = JSON.parse(data);
        for(var t=0;t<data1.length;t++){
            var tr = document.createElement("tr");
            var td = document.createElement("td");
            td.innerHTML = new Date(data1[t].DateOfStart).toLocaleDateString();
            tr.appendChild(td);
            td = document.createElement("td");
            var diff = String(data1[t].TimeToPlay);
            diff=diff.substring(0,8);
            td.innerHTML = diff;
            tr.appendChild(td);
            td = document.createElement("td");
            if (data1[t].Result == 0) {
                td.innerHTML = "WinOfUser";
            }
            else
                if (data1[t].Result == 1) {
                    td.innerHTML = "WinOfComputer";
                } 
                else td.innerHTML = "Draw";

            tr.appendChild(td);
            td = document.createElement("td");
            if (data1[t].X==1)
                td.innerHTML = "X";
            else
                    td.innerHTML = "O";
            tr.appendChild(td);
            td = document.createElement("td");
            td.innerHTML = data1[t].CountOfStep;
            tr.appendChild(td);
            $("#mt tbody").append(tr);
        }

    }
    $.connection.hub.start().done(function () {
    })
    </script>

}
